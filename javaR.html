<!DOCTYPE html>
<html lang="zh-CN"> 
<head>
	<meta charset="utf-8">
	<title>Java与R的互相调用 | MENBIN'S Blog</title>
	<meta name="description" content="Java基于R开发小软件的教程">
	<meta name="author" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Enable responsive viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- 国产高速渲染 -->
	<meta name="renderer" content="webkit">
	<link rel="shortcut icon" href="./img/favicon.ico">	
	<link rel="canonical" href="./javaR.html">
	<!-- Le styles -->
	<link href="./css/bootstrap.min.css" rel="stylesheet">
	<link href="./css/font-awesome.min.css" rel="stylesheet">
	<link href="./css/style.css" rel="stylesheet">
</head>

<body ontouchstart="">

	<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://binmen.github.io/blog">MENBIN</a>
        </div>

        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="./index.html">Home</a></li>
					<li><a href="./categories.html">Categories</a></li>
					<li><a href="">Tags</a></li>
					<li><a href="./About.html">About Me</a></li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');
	
	var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
	 *
	 * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>

	
	<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('./img/javaR.png')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Java与R的互相调用</h1>
                    <h2 class="subheading">Java基于R开发小软件的教程</h2>
                    <span class="meta">Posted by MenBin on June 6, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<article>
<!-- Main Content -->
	<div class="container">
		<div class="row">

		<!-- Post Container -->
    		<div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">
				<h2 class="no_toc" id="section">目录</h2>
                <ul id="markdown-toc">
                <li><a href="#section" id="markdown-toc-section">写在前面的话</a></li>
                <li><a href="#section-1" id="markdown-toc-#section-1">第一篇 在Java中调用R语言</a>
                <li><a href="#section-2" id="markdown-toc-#section-2">Rserve的安装</a></li>
				<li><a href="#section-3" id="markdown-toc-#section-3">Java代码的实现</a></li>
				<li><a href="#section-4" id="markdown-toc-#section-4">Java调用R必备的程序包</a></li>
				<li><a href="#section-5" id="markdown-toc-#section-5">Java连接R的语句</a></li>
				<li><a href="#section-6" id="markdown-toc-#section-6">利用exe4j对程序进行打包教程</a></li>
				<li><a href="#section-7" id="markdown-toc-#section-7">软件展示</a></li>
				<li><a href="#section-8" id="markdown-toc-#section-8">未完待续</a></li>
				</ul>
                <hr><ul class="tag_box list-unstyled list-inline"</ul></hr>
    			<h2 id="section">写在前面的话</h2>

<p>Java与R的介绍</p>
<blockquote>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Java作为主流的应用软件开发语言，已经被广泛的应用到各种项目中；而R语言作为最主流的统计软件之一，以其广泛的程序包以及统计作图能力，受到越来越多人的青睐。如何
把两种语言完美的结合在一起，一直是我在思考的问题，经过查阅大量的资料，终于发现了Java与R的完美衔接，因此就有了这篇文章的介绍。
</blockquote>
<h2 id="section-1">第一篇   在Java中调用R语言</h2>
<p>本文以机器学习中的<a  href="http://binmen.github.io/cy">回归树算法</a>为例，介绍Java中是如何调用R语言的；除此之外我还为此程序做了个<code class="highlighter-rouge">GUI</code>，最后通过<code class="highlighter-rouge">exe4j</code>进行打包；下面是在Java中调用R的基本步骤：</p>
<ul>
  <li>在Java中调用R，有两种方式，一种是通过<code class="highlighter-rouge">Rserve</code>包进行连接，使用这种包的原理是R作为服务器，而Java作为前台程序；另外一种是通过<code class="highlighter-rouge">JNI</code>进行动态连接。在这里我主要介绍如何利用<code class="highlighter-rouge">Rserve</code>进行连接。</li>
  <li>Java环境的配置以及开发工具<code class="highlighter-rouge">Eclipse</code>的安装</li>
  <li>Java打包软件<code class="highlighter-rouge">exe4j</code>的安装</li>
  <li>利用<code class="highlighter-rouge">exe4j</code>软件进行程序打包的教程</li>
</ul>
<h3 id="section-2">Rserve的安装</h3>
<p>在R的任意版本中通过<kbd>install.packages("Rserve")</kbd>命令都可以完成Rserve包的安装，安装以后加载一下此包，通过<kbd>library(Rserve)</kbd>命令实现，然后通过<kbd>Rserve()</kbd>进行服务器的开启。</p>
<h3 id="section-3">Java代码的实现</h3>
<pre>package cn.Whu.Ryl.R;
//导入Java调用R必备的包;
import org.rosuda.REngine.REXPMismatchException;
import org.rosuda.REngine.REngineException;
import org.rosuda.REngine.Rserve.*;
import rserver.function.RService;
import org.rosuda.REngine.REXP;
//######################################
import java.awt.FlowLayout;
import javax.swing.ImageIcon; 
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JTextArea; 
import javax.swing.JScrollPane; 
import javax.swing.JLabel;
import javax.swing.JToolBar;
import java.io.File;
import java.awt.*;
import java.awt.event.*;
import java.io.BufferedReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.BufferedReader;  
import java.io.BufferedWriter;  
import java.io.FileInputStream;  
import java.io.FileOutputStream;  
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;  
import java.io.InputStreamReader;  
import java.io.OutputStream;  
import java.io.OutputStreamWriter;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import java.io.File;
/////////////////////
import javax.imageio.ImageIO;
import javax.imageio.ImageReadParam;
import javax.imageio.ImageReader;
import javax.imageio.stream.ImageInputStream;
//////////////////////
public class Rtest extends JFrame{
	private JLabel jLabel1 = new JLabel();
	public  JTextArea show=new JTextArea("等待程序运行...",8,57);
    final JTextArea hc=new JTextArea();
    final JTextArea hc1=new JTextArea();
    private JMenuBar mb;        //菜单棒  
    private JMenu fileMenu;     //文件菜单 
    private JMenu fileMenu1;   //图片显示 
    private JMenu helpMenu;   //帮助菜单 
    private JMenuItem fileMenuRun,fileMenucp,fileMenuNMSE,fileMenNMSE1,fileMenupre,fileMenucpm;  //回归树操作
    private JMenuItem fileMenu11,fileMenu12,fileMenu13;  //节点信息
    private JMenuItem helpauthor,helpMenuhe,helpbug,helpcode;   //帮助 
    //工具栏成员属性声明  
    private JToolBar toolBar;   //工具棒  
    private JButton b1,b2,b3;//声明1个按钮 
    final  Font f=new Font("sanserif",Font.PLAIN,12); 
    ///定义Rserve类;
    private RService rService;
    public Rtest() throws REXPMismatchException, REngineException{   
    	super("机器学习--决策树");
    	////////设置图标
    	//try {
    	    // String src = "/image/logo.png";     //图片路径
    	     //Image image=ImageIO.read(this.getClass().getResource(src));
    	      //this.setIconImage(image);        //设置图标
    	     // } catch (IOException e) {
    	    //   e.printStackTrace();
    	   // } 
    	/////////////////////////////////////////////////////////////
    	mb = new JMenuBar();    //创建菜单棒  
        fileMenu = new JMenu("操作(R)");//创建菜单  
        fileMenuRun = new JMenuItem("回归树"); 
        fileMenuNMSE= new JMenuItem("查看剪枝前的NMSE与NMSE0信息");
        fileMenucp= new JMenuItem("查看CP的各种信息");
        fileMenucpm= new JMenuItem("CP的最小值");
        fileMenNMSE1= new JMenuItem("查看剪枝后的NMSE与NMSE0信息");  
        fileMenupre= new JMenuItem("真实值与预测值比较");
        fileMenu.add(fileMenuRun);
        fileMenu.addSeparator(); //添加分割线;
        fileMenu.add(fileMenucp);
        fileMenu.add(fileMenucpm);
        fileMenu.addSeparator(); //添加分割线;
        fileMenu.add(fileMenuNMSE);
        fileMenu.add(fileMenNMSE1);
        fileMenu.addSeparator(); 
        fileMenu.add(fileMenupre); 
        fileMenucp.setEnabled(false);
        fileMenucpm.setEnabled(false);
        fileMenuNMSE.setEnabled(false);
        fileMenNMSE1.setEnabled(false);
        fileMenupre.setEnabled(false);
        //图片显示;
        fileMenu1 = new JMenu("节点信息(J)");//创建节点信息
        fileMenu11= new JMenuItem("剪枝前的节点图");
        fileMenu12= new JMenuItem("剪枝后的节点图");
        fileMenu13= new JMenuItem("真实值与预测值对比图");
        fileMenu1.add(fileMenu11);
        fileMenu1.add(fileMenu12);
        fileMenu1.addSeparator();
        fileMenu1.add(fileMenu13);
        fileMenu11.setEnabled(false);
        fileMenu12.setEnabled(false);
        fileMenu13.setEnabled(false);
        ///帮助
        helpMenu = new JMenu("关于(H)");  
        helpauthor = new JMenuItem("作者(A) Ctrl+A");  
        helpMenuhe = new JMenuItem("帮助(H) Ctrl+H");
        helpbug = new JMenuItem("日志(D) Ctrl+D");
        helpcode = new JMenuItem("代码 (C) Ctrl+C"); 
        helpMenu.add(helpauthor);
        helpMenu.addSeparator();
        helpMenu.add(helpbug);
        helpMenu.add(helpcode);
        helpMenu.addSeparator();
        helpMenu.add(helpMenuhe);   
        //将菜单全部添加菜单棒里  
        mb.add(fileMenu);
        mb.add(fileMenu1);
        mb.add(helpMenu); 
        //工具栏的实现   
        toolBar =new JToolBar();    //创建工具棒  
        b1= new JButton(new ImageIcon("img/1.png"));  
        b2= new JButton(new ImageIcon("img/3.png"));
        b3= new JButton(new ImageIcon("img/2.png")); 
        //把按钮全部添加到工具棒中  
        toolBar.add(b1); 
        toolBar.add(b2); 
        toolBar.add(b3); 
        b3.setEnabled(false);
        b2.setEnabled(false);
        //把菜单栏、工具栏、弹出菜单添加到内容面板  
        setJMenuBar(mb);  
        add(toolBar,BorderLayout.NORTH);  
    	//////窗体布局;
        setLayout(new FlowLayout(FlowLayout.LEADING));
        setSize(650, 650);
        setResizable(true);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setVisible(true);  
        show.setEditable(false);
        add(show);
        add(hc);add(hc1);
        add(jLabel1);
        /////设置滚动条，并添加到内容面板;
        add(new JScrollPane(show)); 
        hc.setVisible(false);hc1.setVisible(false);
        jLabel1.setVisible(false);
        ////创建默认文件夹;
        File file1 = new File("c:\\datacy");
        file1.mkdirs();
        file1 = new File("c:\\datacy");
        file1.mkdir();
        /////回归树运行;
        fileMenuRun.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) { 
        	show.setText(" ");
        	rService = new RService();
     		final RConnection re = rService.startTransaction(); // 开始独占工作空间 
     		try {	
     			REXP c1=re.eval("library(lars)");
     			REXP c2=re.eval("data(diabetes)");
     			REXP c3=re.eval("dataset<-diabetes");
     			REXP c4=re.eval("#查看数据以及变量");
     			REXP c5=re.eval("s<-str(diabetes)");
     			REXP c6=re.eval("#查看部分数据集");
     			REXP c8=re.eval("#决策树拟合");
     			REXP c9=re.eval("w<-diabetes[,2:3]");
     			REXP c10=re.eval("library(rpart.plot)");
     			REXP c11=re.eval("reg<-rpart(y~.,w)  ");
     			re.eval("jpeg('c:/datacy/test1.jpg')");
     			re.eval("rpart.plot(reg,type=4,faclen=T)");
     			re.eval("dev.off()");
     			REXP c13=re.eval("#查看具体节点");
     			re.eval("p<-print(reg)");
     			REXP c15=re.eval("#交叉验证");
     			REXP c16=re.eval("w<-diabetes[,2:3]  ");
     			REXP c17=re.eval("n<-length(w$y)  ");
     			REXP c18=re.eval("index1<-1:n  ");
     			REXP c19=re.eval("index2<-rep(1:5,ceiling(n/5))[1:n]  ");
     			REXP c20=re.eval("#从n个数据中随机抽取n/5个数据作为测试集;");
     			REXP c21=re.eval("index2<-sample(index2,n)");
     			REXP c22=re.eval("NMSE<-rep(0,5)");
     			REXP c23=re.eval("NMSE0<-NMSE");
     			REXP c24=re.eval("for(i in 1:5){m<-index1[index2==i];reg<-rpart(y~.,w[-m,]);y0<-predict(reg,w[-m,]);y1<-predict(reg,w[m,]);NMSE0[i]<-mean((w$y[-m]-y0)^2)/mean((w$y[-m]-mean(w$y[-m]))^2);NMSE[i]<-mean((w$y[m]-y1)^2)/mean((w$y[m]-mean(w$y[m]))^2);}");
     			REXP C241=re.eval("nmse<-data.frame(NMSE,NMSE0)");
     			///将NMSE写入;
     			REXP c331=re.eval("write.csv(nmse,\"c:/datacy/NMSE.csv\")");
     			REXP c34=re.eval("#查看cp值");
     			///查看cp值;
     			REXP c35=re.eval("cp<-reg$cptable");
     			REXP c351=re.eval("write.csv(cp,\"c:/datacy/cp.csv\")");
     			REXP c36=re.eval("#进行剪枝");
     			REXP c37=re.eval("reg2<-prune(reg,cp=reg$cptable[which.min(reg$cptable[,\"xerror\"]),\"CP\"]) ");
     			REXP c370=re.eval("cp=reg$cptable[which.min(reg$cptable[,\"xerror\"]),\"CP\"]");
     			re.eval("jpeg('c:/datacy/test2.jpg')");
     			re.eval("rpart.plot(reg2,type=2,faclen=T)");
     			re.eval("dev.off()");
     			REXP c39=re.eval("#剪枝后的交叉验证");
     			REXP c40=re.eval("w<-diabetes[,2:3]");
     			REXP c41=re.eval("n<-length(w$y)  ");
     			REXP c42=re.eval("index1<-1:n");
     			REXP c43=re.eval("index2<-rep(1:5,ceiling(n/5))[1:n]  ");
     			REXP c44=re.eval("#从n个数据中随机抽取n/5个数据作为测试集;");
     			REXP c45=re.eval("index2<-sample(index2,n)  ");
     			REXP c46=re.eval("NMSE<-rep(0,5)  ");
     			REXP c47=re.eval("NMSE0<-NMSE");
     			REXP c48=re.eval("for(i in 1:5){m<-index1[index2==i];reg<-rpart(y~.,w[-m,]);y0<-predict(reg2,w[-m,]);y1<-predict(reg2,w[m,]);NMSE0[i]<-mean((w$y[-m]-y0)^2)/mean((w$y[-m]-mean(w$y[-m]))^2);NMSE[i]<-mean((w$y[m]-y1)^2)/mean((w$y[m]-mean(w$y[m]))^2);}");
     			REXP c55=re.eval("NMSE1<-data.frame(NMSE,NMSE0)");
     			///将NMSE写入;
     			REXP c551=re.eval("write.csv(NMSE1,\"c:/datacy/NMSE1.csv\")");
     			REXP c57=re.eval("#回归树进行预测");
     			REXP c58=re.eval("predata<-predict(reg2,data=w)");
     			REXP c59=re.eval("realdata<-w$y[c(1:354)]");
     			REXP c590=re.eval("predata<-ceiling(predata)");
     			REXP c60=re.eval("pre<-data.frame(predata,realdata)");
     			//输出预测值跟真实值;
     			REXP c601=re.eval("write.csv(pre,\"c:/datacy/pre.csv\")");
     			//输出预测值跟真实值的对比图;
     			re.eval("jpeg('c:/datacy/test3.jpg')");
     			REXP c602=re.eval("arange <- range(0,realdata,predata);plot(realdata,type=\"o\",col=\"blue\",ylim=arange,ann=FALSE);lines(predata, type=\"o\", pch=22, lty=2, col=\"red\");title(xlab=\"order_num\",col.lab=rgb(0,0.5,0));title(ylab=\" \",col.lab=rgb(0,0.5,0));legend(1,arange[2],c(\"realdata\",\"predata\"),cex=0.7,col=c(\"blue\",\"red\"),pch=21:22,lty=1:2)");
     			re.eval("dev.off()");
     			re.close();
     			//System.out.println(c55.asString());
     			hc.setText(c370.asString());
     		} catch (Exception y) {
     			System.out.println("Failed to create temp file" +y);
     			y.printStackTrace();
     		} finally {	
     		}
        	show.setText("回归树程序已运行完毕！！主要输出结果为：CP信息,NMSE信息以及节点图");
        	fileMenucp.setEnabled(true);
            fileMenuNMSE.setEnabled(true);
            fileMenNMSE1.setEnabled(true);
            fileMenupre.setEnabled(true);
            fileMenu11.setEnabled(true);
            fileMenu12.setEnabled(true);
            fileMenu13.setEnabled(true);
            fileMenucpm.setEnabled(true);
            b2.setEnabled(true);
            }
        }); 
      ///查看NMSE数据;
        fileMenuNMSE.addActionListener(new ActionListener() {
    	        public void actionPerformed(ActionEvent e) {
    	    		try{show.read(new FileReader("c:/datacy/NMSE.csv"),null);}  
    	                catch(IOException s){}
         			BufferedWriter bw = null;
                    try {
                        OutputStream os = new FileOutputStream("c:/datacy/NMSE.csv");
                        bw = new BufferedWriter(new OutputStreamWriter(os));
                        for (String value : show.getText().split("\n")) {
                            bw.write(value);
                            bw.newLine();//换行
                        }
                    } catch (IOException e1) {
                    } finally {
                        if (bw != null) {
                            try {
                                bw.close();
                            } catch (IOException e1) {}
                        }
                    }
    	        }
    	 }
        );
      ///查看预测值跟真实值数据;
        fileMenupre.addActionListener(new ActionListener() {
    	        public void actionPerformed(ActionEvent e) {
    	    		try{show.read(new FileReader("c:/datacy/pre.csv"),null);}  
    	                catch(IOException s){}
         			BufferedWriter bw = null;
                    try {
                        OutputStream os = new FileOutputStream("c:/datacy/pre.csv");
                        bw = new BufferedWriter(new OutputStreamWriter(os));
                        for (String value : show.getText().split("\n")) {
                            bw.write(value);
                            bw.newLine();//换行
                        }
                    } catch (IOException e1) {
                    } finally {
                        if (bw != null) {
                            try {
                                bw.close();
                            } catch (IOException e1) {}
                        }
                    }
    	        }
    	 }
        );
         ///查看NMSE1数据;
        fileMenNMSE1.addActionListener(new ActionListener() {
    	        public void actionPerformed(ActionEvent e) {
    	    		try{show.read(new FileReader("c:/datacy/NMSE1.csv"),null);}  
    	                catch(IOException s){}
         			BufferedWriter bw = null;
                    try {
                        OutputStream os = new FileOutputStream("c:/datacy/NMSE1.csv");
                        bw = new BufferedWriter(new OutputStreamWriter(os));
                        for (String value : show.getText().split("\n")) {
                            bw.write(value);
                            bw.newLine();//换行
                        }
                    } catch (IOException e1) {
                    } finally {
                        if (bw != null) {
                            try {
                                bw.close();
                            } catch (IOException e1) {}
                        }
                    }
    	        }
    	 }
        );
    ///查看cp值;
    fileMenucp.addActionListener(new ActionListener() {
	        public void actionPerformed(ActionEvent e) {
	    		try{show.read(new FileReader("c:/datacy/cp.csv"),null);}  
	                catch(IOException s){}
     			BufferedWriter bw = null;
                try {
                    OutputStream os = new FileOutputStream("c:/datacy/cp.csv");
                    bw = new BufferedWriter(new OutputStreamWriter(os));
                    for (String value : show.getText().split("\n")) {
                        bw.write(value);
                        bw.newLine();//换行
                    }
                } catch (IOException e1) {
                } finally {
                    if (bw != null) {
                        try {
                            bw.close();
                        } catch (IOException e1) {}
                    }
                }
	        }
	 }
    );
    ///查看最小的cp值;
    fileMenucpm.addActionListener(new ActionListener() {
	        public void actionPerformed(ActionEvent e) {
	    		show.setText("最小的CP值为："+"\n"+hc.getText());
	 }
    }
    );
      //文件读取;
    b1.addActionListener(new ActionListener() {
	        public void actionPerformed(ActionEvent e) {
	        	JFileChooser jfc=new JFileChooser();
	        	jfc.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
	    		jfc.showDialog(new JLabel(), "选择文件：");
	    		File file=jfc.getSelectedFile();
	    		try{show.read(new FileReader(file),null);}  
	                catch(IOException s){}
     			BufferedWriter bw = null;
                try {
                    OutputStream os = new FileOutputStream(file);
                    bw = new BufferedWriter(new OutputStreamWriter(os));
                    for (String value : show.getText().split("\n")) {
                        bw.write(value);
                        bw.newLine();//换行
                    }
                } catch (IOException e1) {
                } finally {
                    if (bw != null) {
                        try {
                            bw.close();
                        } catch (IOException e1) {}
                    }
                }
	        }
	 }
    );
    /////关于信息;
    helpauthor.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) {
        	String value="作者：门斌"+"\n"+"东北财经大学"+"\n"+"© 版权所有";
        	int n = JOptionPane.showConfirmDialog(null, value, "关于作者", JOptionPane.YES_NO_OPTION);   
        }
 }
);
    ///查看错误日志;
    helpbug.addActionListener(new ActionListener() {
	        public void actionPerformed(ActionEvent e) {
	    		try{show.read(new FileReader("error.log"),null);}  
	                catch(IOException s){}
     			BufferedWriter bw = null;
                try {
                    OutputStream os = new FileOutputStream("error.log");
                    bw = new BufferedWriter(new OutputStreamWriter(os));
                    for (String value : show.getText().split("\n")) {
                        bw.write(value);
                        bw.newLine();//换行
                    }
                } catch (IOException e1) {
                } finally {
                    if (bw != null) {
                        try {
                            bw.close();
                        } catch (IOException e1) {}
                    }
                }
	        }
	 }
    );
  ///查看代码;
    helpcode.addActionListener(new ActionListener() {
	        public void actionPerformed(ActionEvent e) {
	    		try{show.read(new FileReader("code.txt"),null);}  
	                catch(IOException s){}
     			BufferedWriter bw = null;
                try {
                    OutputStream os = new FileOutputStream("code.txt");
                    bw = new BufferedWriter(new OutputStreamWriter(os));
                    for (String value : show.getText().split("\n")) {
                        bw.write(value);
                        bw.newLine();//换行
                    }
                } catch (IOException e1) {
                } finally {
                    if (bw != null) {
                        try {
                            bw.close();
                        } catch (IOException e1) {}
                    }
                }
	        }
	 }
    );
    /////帮助信息;
    helpMenuhe.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) {
        	show.setText("正在打开帮助文档，请稍后...");
        	try {
				Runtime.getRuntime().exec("cmd /c start http:binmen.github.io/cy");
				show.setText("帮助文档已打开！！");
			} catch (IOException e1) {
				e1.printStackTrace();
			}
        }
 }  
);
    /////剪枝前的节点图读取;
    fileMenu11.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) {
        	jLabel1.setVisible(true);
 			int width = 630; 
 			int height = 450;
 		    ImageIcon pic1 = new ImageIcon("c:/datacy/test1.jpg");
 		    pic1.setImage(pic1.getImage().getScaledInstance(width,height,Image.SCALE_DEFAULT));
 		    jLabel1.setIcon(pic1);
 	        add(jLabel1);
        }
 }
);
    /////剪枝后的节点图读取;
    fileMenu12.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) {
        	jLabel1.setVisible(true);
 			int width = 630; 
 			int height = 450;
 		    ImageIcon pic1 = new ImageIcon("c:/datacy/test2.jpg");
 		    pic1.setImage(pic1.getImage().getScaledInstance(width,height,Image.SCALE_DEFAULT));
 		    jLabel1.setIcon(pic1);
 	        add(jLabel1);
        }
 }
);
    /////真实值与预测值对比图;
    fileMenu13.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) {
        	jLabel1.setVisible(true);
 			int width = 630; 
 			int height = 480;
 		    ImageIcon pic1 = new ImageIcon("c:/datacy/test3.jpg");
 		    pic1.setImage(pic1.getImage().getScaledInstance(width,height,Image.SCALE_DEFAULT));
 		    jLabel1.setIcon(pic1);
 	        add(jLabel1);
        }
 }
);
/////回归树运行;
    b2.addActionListener(new ActionListener() {
    public void actionPerformed(ActionEvent e) { 
    		rService = new RService();
 		final RConnection re = rService.startTransaction(); // 开始独占工作空间 
 		try {	
 			REXP c1=re.eval("library(lars)");
 			//REXP c2=re.eval("data(diabetes)");
 			REXP c3=re.eval("dataset<-diabetes");
 			REXP c4=re.eval("#查看数据以及变量");
 			REXP c5=re.eval("s<-str(diabetes)");
 			REXP c6=re.eval("#查看部分数据集");
 			REXP c8=re.eval("#决策树拟合");
 			REXP c9=re.eval("w<-diabetes[,2:3]");
 			REXP c10=re.eval("library(rpart.plot)");
 			REXP c11=re.eval("reg<-rpart(y~.,w)  ");
 			re.eval("jpeg('c:/datacy/test1.jpg')");
 			re.eval("rpart.plot(reg,type=4,faclen=T)");
 			re.eval("dev.off()");
 			REXP c13=re.eval("#查看具体节点");
 			re.eval("p<-print(reg)");
 			REXP c15=re.eval("#交叉验证");
 			REXP c16=re.eval("w<-diabetes[,2:3]  ");
 			REXP c17=re.eval("n<-length(w$y)  ");
 			REXP c18=re.eval("index1<-1:n  ");
 			REXP c19=re.eval("index2<-rep(1:5,ceiling(n/5))[1:n]  ");
 			REXP c20=re.eval("#从n个数据中随机抽取n/5个数据作为测试集;");
 			REXP c21=re.eval("index2<-sample(index2,n)");
 			REXP c22=re.eval("NMSE<-rep(0,5)");
 			REXP c23=re.eval("NMSE0<-NMSE");
 			REXP c24=re.eval("for(i in 1:5){m<-index1[index2==i];reg<-rpart(y~.,w[-m,]);y0<-predict(reg,w[-m,]);y1<-predict(reg,w[m,]);NMSE0[i]<-mean((w$y[-m]-y0)^2)/mean((w$y[-m]-mean(w$y[-m]))^2);NMSE[i]<-mean((w$y[m]-y1)^2)/mean((w$y[m]-mean(w$y[m]))^2);}");
 			REXP C241=re.eval("nmse<-data.frame(NMSE,NMSE0)");
 			///将NMSE写入;
 			REXP c331=re.eval("write.csv(nmse,\"c:/datacy/NMSE.csv\")");
 			REXP c34=re.eval("#查看cp值");
 			///查看cp值;
 			REXP c35=re.eval("cp<-reg$cptable");
 			REXP c351=re.eval("write.csv(cp,\"c:/datacy/cp.csv\")");
 			REXP c36=re.eval("#进行剪枝");
 			REXP c37=re.eval("reg2<-prune(reg,cp=reg$cptable[which.min(reg$cptable[,\"xerror\"]),\"CP\"]) ");
 			REXP c370=re.eval("cp=reg$cptable[which.min(reg$cptable[,\"xerror\"]),\"CP\"]");
 			re.eval("jpeg('c:/datacy/test2.jpg')");
 			re.eval("rpart.plot(reg2,type=2,faclen=T)");
 			re.eval("dev.off()");
 			REXP c39=re.eval("#剪枝后的交叉验证");
 			REXP c40=re.eval("w<-diabetes[,2:3]");
 			REXP c41=re.eval("n<-length(w$y)  ");
 			REXP c42=re.eval("index1<-1:n");
 			REXP c43=re.eval("index2<-rep(1:5,ceiling(n/5))[1:n]  ");
 			REXP c44=re.eval("#从n个数据中随机抽取n/5个数据作为测试集;");
 			REXP c45=re.eval("index2<-sample(index2,n)  ");
 			REXP c46=re.eval("NMSE<-rep(0,5)  ");
 			REXP c47=re.eval("NMSE0<-NMSE");
 			REXP c48=re.eval("for(i in 1:5){m<-index1[index2==i];reg<-rpart(y~.,w[-m,]);y0<-predict(reg2,w[-m,]);y1<-predict(reg2,w[m,]);NMSE0[i]<-mean((w$y[-m]-y0)^2)/mean((w$y[-m]-mean(w$y[-m]))^2);NMSE[i]<-mean((w$y[m]-y1)^2)/mean((w$y[m]-mean(w$y[m]))^2);}");
 			REXP c55=re.eval("NMSE1<-data.frame(NMSE,NMSE0)");
 			///将NMSE写入;
 			REXP c551=re.eval("write.csv(NMSE1,\"c:/datacy/NMSE1.csv\")");
 			REXP c57=re.eval("#回归树进行预测");
 			REXP c58=re.eval("predata<-predict(reg2,data=w)");
 			REXP c59=re.eval("realdata<-w$y[c(1:354)]");
 			REXP c590=re.eval("predata<-ceiling(predata)");
 			REXP c60=re.eval("pre<-data.frame(predata,realdata)");
 			//输出预测值跟真实值;
 			REXP c601=re.eval("write.csv(pre,\"c:/datacy/pre.csv\")");
 			//输出预测值跟真实值的对比图;
 			re.eval("jpeg('c:/datacy/test3.jpg')");
 			REXP c602=re.eval("arange <- range(0,realdata,predata);plot(realdata,type=\"o\",col=\"blue\",ylim=arange,ann=FALSE);lines(predata, type=\"o\", pch=22, lty=2, col=\"red\");title(xlab=\"order_num\",col.lab=rgb(0,0.5,0));title(ylab=\" \",col.lab=rgb(0,0.5,0));legend(1,arange[2],c(\"realdata\",\"predata\"),cex=0.7,col=c(\"blue\",\"red\"),pch=21:22,lty=1:2)");
 			re.eval("dev.off()");
 			re.close();
 			//System.out.println(c55.asString());
 			hc.setText(c370.asString());
 		} catch (Exception y) {
 			System.out.println("Failed to create temp file" +y);
 			y.printStackTrace();
 		} finally {	
 		}
 		jLabel1.setVisible(false);
 		show.setText("回归树程序已运行完毕！！主要输出结果为：CP信息,NMSE信息以及节点图");
        fileMenucp.setEnabled(true);
        fileMenuNMSE.setEnabled(true);
        fileMenNMSE1.setEnabled(true);
        fileMenupre.setEnabled(true);
        fileMenu11.setEnabled(true);
        fileMenu12.setEnabled(true);
        fileMenu13.setEnabled(true);
        fileMenucpm.setEnabled(true);
        }
    });
} 
public static void main(String[] args) throws REXPMismatchException,REngineException{
         new Rtest();
    }
}
</pre>
<h3 id="section-4">Java调用R必备的程序包</h3>
<p>在Java调用R必须先导入以下包，这是Java中调用R语言必备的包</p>
<pre>import org.rosuda.REngine.REXPMismatchException;
import org.rosuda.REngine.REngineException;
import org.rosuda.REngine.Rserve.*;
import rserver.function.RService;
import org.rosuda.REngine.REXP;</pre>
<h3 id="section-5">Java连接R的语句</h3>
<pre>rService = new RService();
final RConnection re = rService.startTransaction();
</pre>
<p>这是Java连接R的语句</p>
<h2 id="section-6">利用exe4j对程序进行打包教程(暂未开放)</h2>
<h2 id="section-7">软件展示</h2>
<img src="./img/javaR.jpg" />
<h2 id="section-8">未完待续</h2>	
<hr><ul class="tag_box list-unstyled list-inline"</ul></hr>
				<p class="text-right">
				<a href="./index.html">MENBIN</a>
				<span class="time">
				<time><span class="label label-primary label-md"><strong>2016-06-06</strong></span></time>
				</br>地点：中国--大连--东财
				</span>
				</p>
<hr>					
					<ul class="tag_box list-unstyled list-inline">
					</ul>
					<hr>
					
                <!-- 多说 Share start -->
				<div class="ds-share"
                    style="text-align: right"
                    data-thread-key="./javaR"
                    data-title="Java与R的互相调用"
                    data-url="http://binmen.github.io/blogs/javaR"
                    data-content="Java基于R开发小软件的教程" >
                    <div class="ds-share-inline">
                      <ul  class="ds-share-icons-16">
                        <li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
                        <li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>
                        <li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li>
                        <li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
                      </ul>
                      <div class="ds-share-icons-more">
                      </div>
                    </div>
                <hr>
                </div>
                <!-- 多说 Share end-->
                    <ul class="pager">
                <!--如果可以向前翻页，<li class="previous  disabled"><a href="/blog/2016/02/25/git-junior/" data-toggle="tooltip" data-placement="top" title="Git进阶1">-->
					 <li class="next   disabled"><a>NEXT</a></li>
		            <li class="previous"><a href="./echarts.html" data-toggle="tooltip" data-placement="top" title="“在网页中使用Echarts绘图">PREVIOUS</br>在网页中使用Echarts绘图</a></li>
                </ul> 
                <!-- 多说评论框 start -->
                <div class="comment">
                    <div class="ds-thread"
                        data-thread-key="./javaR"
                        data-title="Java与R的互相调用"
                        data-url="http://binmen.github.io/blogs/javaR/" >
                    </div>
                </div>
                <!-- 多说评论框 end -->
            </div>
    </div>
		<!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">
                <!-- Friends Blog -->
                
                <hr>
                <h5>友情链接</h5>
                <ul class="list-inline">
                    
                       <li><a href="http://benmin.github.io/blog">数据泥瓦匠</a></li>
                    
                        <li><a href="https://github.com/Huxpro/huxpro.github.io">Hux-模板来源</a></li>
                    
                        <li><a href="http://brucezhaor.github.io/">brucezhaor</a></li>
						
						<li><a href="http://binmen.github.io/Simple">团队作品</a></li>
                    
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>


<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">

    var _user = 'menbin';
    // duoshuo comment query.
    var duoshuoQuery = {short_name: _user };
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
</script>
<!-- 多说公共JS代码 end -->
<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options.placement = 'left';
        anchors.add('h2,h3');
		anchors.remove('.subheading');
    })
</script>


<!-- mathjax -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<!-- for R highlight -->
<script type="text/javascript" src="./js/r-highlight.js"></script>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                 <!--站长统计-->
                 <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1259231356'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1259231356%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>	 
                <p class="copyright text-muted">
                   &copy;2016.MenBin Copyright Reserved. | Powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a> and <a href="http://www.bootcss.com/">Bootstrap</a>.Theme by <a href="http://huangxuan.me">Hux</a> and <a href="http://brucezhaor.github.io/">brucezhaor</a>.
					<br>
					<span class="label label-primary label-md"><strong>转载请标明作者和出处</strong></span>
                </p>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/bootstrap.min.js"></script>
<script type="text/javascript" src="./js/blog.js"></script>
	
<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
	
	<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);  
    })
</script>

<!-- back-to-top -->
<div id="back-top">
  <a href="#section" data-toggle="tooltip" data-placement="top" title="top">
	<i class="fa fa-chevron-up"></i>
  </a>
</div>
<script type="text/javascript" src="./js/jquery-1.8.3.js"></script>
<script>
	$('#back-top').hide();
	$(document).ready(function () {
	$(window).scroll(function () {
    if ($(this).scrollTop() > 250) {
      $('#back-top').fadeIn();
    } else {
      $('#back-top').fadeOut();
    }
  });
  $('#back-top a').click(function () {
    $('body,html').animate({
      scrollTop: 0
    }, 800);
    return false;
  });
});
</script>
	
</body>
</html>
